---
title: "Analysis of Trends and Patterns in Vocational Training in Odisha"
author: "Data, Policy, and Innovation Centre"
date: "`r Sys.Date()`"
output: 
  html_document: 
    toc: true
    number_sections: true
---

# Executive Summary

**Purpose**: This report analyzes trends and patterns in vocational training in Odisha using data from the Student Academic Management System (SAMS).

**Key Findings**: Enrollment trends indicate significant variations by gender and social category. 

**Recommendations**: Enhance outreach programs targeting underrepresented groups and improve course availability.

# Table of Contents

# Introduction

Vocational training plays a crucial role in enhancing employability and skill development in Odisha. This report aims to analyze...

# Data Description

The analysis uses data from the Student Academic Management System (SAMS), which includes variables such as...

# Analysis


```{r, echo=FALSE, eval=FALSE}
install.packages("dplyr")
install.packages("tidyverse")
install.packages("knitr")
install.packages("DBI")
install.packages("RSQLite")
install.packages("kableExtra")

```


```{r, echo=FALSE, include=FALSE}
# Load the libraries
library(RSQLite)
library(DBI)
library(dplyr)
library(tidyverse)
library(kableExtra)
library(knitr)


```

```{r, echo=FALSE}
con <- dbConnect(RSQLite::SQLite(), "C:/Users/Admin/Documents/GitHub/sams/data/raw/sams.db")

# Query data for ITI module for years 2017 to 2023
query <- "SELECT * FROM students WHERE module = 'ITI' AND year BETWEEN 2017 AND 2024;"

# Send query to the database
result <- dbSendQuery(con, query)

# Fetch the relevant data
student_data_iti <- dbFetch(result)

# Clear the result
dbClearResult(result)
dbDisconnect(con)

# Admitted students only 
student_iti_admis = student_data_iti %>%
  filter(admission_status == "Yes")

```

```{r, include=FALSE,echo=FALSE}
con <- dbConnect(RSQLite::SQLite(), "C:/Users/Admin/Documents/GitHub/sams/data/raw/sams.db")

# Query data for ITI module for years 2017 to 2023
query <- "SELECT * FROM students WHERE module = 'Diploma' AND year BETWEEN 2018 AND 2024;"

# Send query to the database
result <- dbSendQuery(con, query)

# Fetch the relevant data
student_data_dip <- dbFetch(result)

# Clear the result
dbClearResult(result)
dbDisconnect(con)



## Check the admission count each year
student_dip_admis = student_data_dip[!is.na(student_data_dip$sams_code),]

```

## Demographics

```{r, echo=FALSE,include=FALSE}
## Social Group composition in across years

# Function to calculate % for groups
calculate_percentage <- function(data, x) {
  data %>%
    group_by(year, {{x}}) %>%                              # Use the provided variable (x) for grouping
    summarise(count = n(), .groups = 'drop') %>%
    group_by(year) %>%                                      # Group by year for calculating percentage within each year
    mutate(Percentage = count / sum(count) * 100) %>%
    mutate(Percentage = round(Percentage, 1)) %>%
    ungroup() %>%
    select(year, {{x}}, Percentage) %>%
    pivot_wider(names_from = {{x}}, values_from = Percentage)  # Pivot based on the variable (x)
}

ITI_soc_grp <- calculate_percentage(student_iti_admis, social_category)
poly_soc_grp <- calculate_percentage(student_dip_admis, social_category)
ITI_religion <- calculate_percentage(student_iti_admis, religion_name)
poly_religion <- calculate_percentage(student_dip_admis, religion_name)
ITI_income_grp <- calculate_percentage(student_iti_admis, annual_income) %>%
  select("year", "0-1,00,000", "1,00,000-2,50,000", "2,50,000 - 6,00,000", "Above 6,00,000",  "More than 8,00,000",  "OTHER", "NA")
poly_income_grp <- calculate_percentage(student_dip_admis, annual_income) %>%
  select("year", "Upto 2.5 lakh","Between 2.5 To 8 lakh", "Above 8 lakh", "--")

# Function to calculate % for groups within General category
calculate_percentage_income <- function(data, x) {
  data %>%
    filter(social_category == "General") %>%               # Filter for "General" in social_category
    group_by(year, {{x}}) %>%                              # Group by year and the specified column (income group)
    summarise(count = n(), .groups = 'drop') %>%
    group_by(year) %>%                                      # Group by year for calculating percentage
    mutate(Percentage = count / sum(count) * 100) %>%
    mutate(Percentage = round(Percentage, 1)) %>%
    ungroup() %>%
    select(year, {{x}}, Percentage) %>%
    pivot_wider(names_from = {{x}}, values_from = Percentage)  # Pivot based on the variable (income group)
}

iti_general_income = calculate_percentage_income(student_iti_admis, annual_income)  %>%
  select("year", "0-1,00,000", "1,00,000-2,50,000", "2,50,000 - 6,00,000", "Above 6,00,000",  "More than 8,00,000",  "OTHER", "NA")
poly_general_income = calculate_percentage_income(student_dip_admis, annual_income) 

# Pivot table ITI for social_group and income_group in the year 2023
pivot_table_iti_inc_soc_2023 <- student_iti_admis %>%
  filter(year == 2023) %>%                                  # Filter for the year 2023
  group_by(social_category, annual_income) %>%               # Group by social_category and income_group
  summarise(count = n(), .groups = 'drop') %>%              # Count the number of students in each group
  group_by(social_category) %>%                             # Group by social_category to calculate percentage
  mutate(percentage = count / sum(count) * 100) %>%         # Calculate percentage for each income_group
  ungroup() %>%
  mutate(percentage = round(percentage, 1)) %>%             # Round the percentage to one decimal place
  select(-count) %>%                                        # Remove the count column
  pivot_wider(names_from = annual_income,                    # Pivot so that income_group becomes columns
              values_from = percentage,                     # Use the percentage as values
              values_fill = list(percentage = 0)) %>%
  select("social_category", "0-1,00,000", "1,00,000-2,50,000", "2,50,000 - 6,00,000",  "More than 8,00,000",  "OTHER", "NA")           # Fill missing combinations with 0
               # Fill missing combinations with 0

# Pivot table Polytechnics for social_group and income_group in the year 2023
pivot_table_dip_inc_soc_2023 <- student_dip_admis %>%
  filter(year == 2023) %>%                                  # Filter for the year 2023
  group_by(social_category, annual_income) %>%               # Group by social_category and income_group
  summarise(count = n(), .groups = 'drop') %>%              # Count the number of students in each group
  group_by(social_category) %>%                             # Group by social_category to calculate percentage
  mutate(percentage = count / sum(count) * 100) %>%         # Calculate percentage for each income_group
  ungroup() %>%
  mutate(percentage = round(percentage, 1)) %>%             # Round the percentage to one decimal place
  select(-count) %>%                                        # Remove the count column
  pivot_wider(names_from = annual_income,                    # Pivot so that income_group becomes columns
              values_from = percentage,                     # Use the percentage as values
              values_fill = list(percentage = 0)) %>%
  select(social_category, `Upto 2.5 lakh`,`Between 2.5 To 8 lakh`, `Above 8 lakh`, `--`)


```

```{r}
ITI_soc_grp %>%
  knitr::kable(caption = "Table _: Social Category Composition ITIs (%)", digits = 1) %>%
  kableExtra::kable_styling(bootstrap_options = "striped",full_width = FALSE)
poly_soc_grp %>% 
  knitr::kable(caption = "Table _: Social Category Composition Polytechnics (%)", digits = 1) %>%
  kableExtra::kable_styling(bootstrap_options = "striped",full_width = FALSE)

ITI_religion %>%
  knitr::kable(caption = "Table _: Religion Composition ITI (%)", digits = 1) %>%
  kableExtra::kable_styling(bootstrap_options = "striped",full_width = FALSE)

poly_religion %>%
  knitr::kable(caption = "Table _: Religion Composition Polytechnics (%)", digits = 1) %>%
  kableExtra::kable_styling(bootstrap_options = "striped",full_width = FALSE)

ITI_income_grp %>%
  knitr::kable(caption = "Table _: Income Group (Annual) Composition ITI (%)", digits = 1) %>%
  kableExtra::kable_styling(bootstrap_options = "striped",full_width = FALSE)

poly_income_grp %>%
  knitr::kable(caption = "Table _: Income Group (Annual) Composition Polytechnics (%)", digits = 1) %>%
  kableExtra::kable_styling(bootstrap_options = "striped",full_width = FALSE)
 
iti_general_income %>%
  knitr::kable(caption = "Table _: Income Group Composition Among General Category ITI (%)", digits = 1) %>%
  kableExtra::kable_styling(bootstrap_options = "striped",full_width = FALSE)

poly_general_income %>%
  knitr::kable(caption = "Table _: Income Group Composition Among General Category Polytechnics (%)", digits = 1) %>%
  kableExtra::kable_styling(bootstrap_options = "striped",full_width = FALSE)

# Note - There is no "General" Category in Polytechnics

pivot_table_iti_inc_soc_2023 %>%
  knitr::kable(caption = "Table _: Social Category Income Group Matrix ITI in % (2023)", digits = 1) %>%
  kableExtra::kable_styling(bootstrap_options = "striped",full_width = FALSE)

pivot_table_dip_inc_soc_2023 %>%
  knitr::kable(caption = "Table _: Social Category Income Group Matrix Polytechnics in % (2023)", digits = 1) %>%
  kableExtra::kable_styling(bootstrap_options = "striped",full_width = FALSE)

```

## Marks
```{r,echo=FALSE, include=FALSE}
library(jsonlite)

# ITI extract two variables from the json_column
student_iti_admis <- student_iti_admis %>%
  mutate(parsed_json = lapply(mark_data, fromJSON)) %>%  # Parse the JSON
  mutate(
    Qualifying_ExamName = sapply(parsed_json, function(x) x$ExamName),   # Extract variable1
    YearofPassing = sapply(parsed_json, function(x) x$YearofPassing)    # Extract variable2
  ) %>%
  select(-parsed_json)  # Remove the parsed_json column if not needed

# Polytechnics extract two variables from the json_column
student_dip_admis <- student_dip_admis %>%
  mutate(parsed_json = lapply(mark_data, fromJSON)) %>%  # Parse the JSON
  mutate(
    Qualifying_ExamName = sapply(parsed_json, function(x) x$ExamName),   # Extract variable1
    YearofPassing = sapply(parsed_json, function(x) x$YearofPassing)    # Extract variable2
  ) %>%
  select(-parsed_json)  # Remove the parsed_json column if not needed

# Trades for Various Qualifications 2023
iti_qual_trade_2023 = student_iti_admis %>%
  filter(year == 2023) %>%
  group_by(Qualifying_ExamName) %>%
  summarise(number_of_trade = n_distinct(reported_branch_or_trade)) 


ITI_graduates_same_year <- student_iti_admis %>%
  filter(Qualifying_ExamName != "8th Pass") %>%
  filter(YearofPassing == year) %>%
  group_by(year) %>%   # Group by admission year
  summarise(Admitted_ITI_Students = n())  # Count the number of students


Poly_graduates_same_year <- student_iti_admis %>%
  filter(Qualifying_ExamName != "8th Pass") %>%
  filter(YearofPassing == year) %>%
  group_by(year) %>%   # Group by admission year
  summarise(Admitted_ITI_Students = n())  # Count the number of students


```


## Geography


```{r}


```




```{r, echo=FALSE}
con <- dbConnect(RSQLite::SQLite(), "C:/Users/Admin/Documents/GitHub/sams/data/raw/sams.db")

# Query data for ITI module for years 2017 to 2023
query <- "SELECT * FROM students WHERE module = 'ITI' AND year BETWEEN 2017 AND 2024;"

# Send query to the database
result <- dbSendQuery(con, query)

# Fetch the relevant data
student_data_iti <- dbFetch(result)

# Clear the result
dbClearResult(result)
dbDisconnect(con)

# Admitted students only 
student_iti_admis = student_data_iti %>%
  filter(admission_status == "Yes")

con <- dbConnect(RSQLite::SQLite(), "C:/Users/Admin/Documents/GitHub/sams/data/raw/sams.db")

# Query data for ITI module for years 2017 to 2023
query <- "SELECT * FROM students WHERE module = 'Diploma' AND year BETWEEN 2018 AND 2024;"

# Send query to the database
result <- dbSendQuery(con, query)

# Fetch the relevant data
student_data_dip <- dbFetch(result)

# Clear the result
dbClearResult(result)
dbDisconnect(con)

# Admitted Students only
student_dip_admis = student_data_dip[!is.na(student_data_dip$sams_code),]


```


## Institutions

```{r, echo=FALSE}

## Student count in ITIs
iti_student_count = student_iti_admis %>%
  group_by(year,typeof_institute) %>%
  summarise(student_count = n(), .groups = "drop")

# Pivot the data wider to have separate columns for Pvt. and Govt. institutes
iti_student_count_pivoted <- iti_student_count %>%
  pivot_wider( 
    names_from = typeof_institute, 
    values_from = student_count, 
    values_fill = 0  # Fill missing values with 0
  )

# Calculate total students and share of Govt. students
iti_student_count_summary <- iti_student_count_pivoted %>%
  # Create a new column for total institutes and share of Govt. institutes, rounded to 1 decimal
  mutate(total_students = Govt. + Pvt.,
         share_of_govt = round((Govt. / total_students) * 100, 1)) %>%
  # Select only the necessary columns
  select(year, total_students, share_of_govt)


## Student count in Polytechnics
dip_student_count = student_dip_admis %>%
  group_by(year,typeof_institute) %>%
  summarise(student_count = n(), .groups = "drop")

# Pivot the data wider to have separate columns for Pvt. and Govt. institutes
dip_student_count_pivoted <- dip_student_count %>%
  pivot_wider( 
    names_from = typeof_institute, 
    values_from = student_count, 
    values_fill = NA  # Fill missing values with NA
  )

# Calculate total students and share of Govt. students
dip_student_count_summary <- dip_student_count_pivoted %>%
  # Create a new column for total institutes and share of Govt. institutes, rounded to 1 decimal
  mutate(total_students = Govt. + Pvt.,
         share_of_govt = round((Govt. / total_students) * 100, 1)) %>%
  # Select only the necessary columns
  select(year, total_students, share_of_govt)



# Student count in ITIs across districts
#iti_student_dist_count = student_iti_admis %>%
#  group_by(year,institute_district,typeof_institute,reported_institute) %>%
#  summarise(student_count = n(), .groups = "drop")
#view(iti_student_count)
# Student count in Polytechnics across districts
#poly_student_dist_count = student_dip_admis %>%
#  group_by(year,institute_district,typeof_institute,reported_institute) %>%
#  summarise(student_count = n(), .groups = "drop")


# ITI Count
iti_institutes_count = student_iti_admis %>%
  group_by(year,typeof_institute) %>%
  summarise(ITI_count = n_distinct(reported_institute), .groups = "drop")

# Pivot the data wider to have separate columns for Pvt. and Govt. institutes
iti_institutes_count_pivoted <- iti_institutes_count %>%
  pivot_wider( 
    names_from = typeof_institute, 
    values_from = ITI_count, 
    values_fill = 0  # Fill missing values with 0
  )

# Calculate total students and share of Govt. students
iti_institutes_count_pivoted_summary <- iti_institutes_count_pivoted %>%
  # Create a new column for total institutes and share of Govt. institutes, rounded to 1 decimal
  mutate(total_institutes = Govt. + Pvt.,
         share_of_govt = round((Govt. / total_institutes) * 100, 1)) %>%
  # Select only the necessary columns
  select(year, total_institutes, share_of_govt)

# Polytechnics Count
poly_institutes_count = student_dip_admis %>%
  group_by(year,typeof_institute) %>%
  summarise(poly_count = n_distinct(reported_institute), .groups = "drop")

# Pivot the data wider to have separate columns for Pvt. and Govt. institutes
poly_institutes_count_pivoted <- poly_institutes_count %>%
  pivot_wider( 
    names_from = typeof_institute, 
    values_from = poly_count, 
    values_fill = 0  # Fill missing values with 0
  )

# Calculate total students and share of Govt. students
poly_institutes_count_pivoted_summary <- poly_institutes_count_pivoted %>%
  # Create a new column for total institutes and share of Govt. institutes, rounded to 1 decimal
  mutate(total_institutes = Govt. + Pvt.,
         share_of_govt = round((Govt. / total_institutes) * 100, 1)) %>%
  # Select only the necessary columns
  select(year, total_institutes, share_of_govt)




# Poly Count across districts
#poly_institutes_count = student_dip_admis %>%
#  group_by(year,institute_district,typeof_institute) %>%
#  summarise(Polytechnics_count = n_distinct(reported_institute), .groups = "drop")


# Plot the district-wise institute count 

# Institutes with highest enrollment 2023
# ITI
iti_level_student_count = student_iti_admis %>%
  filter(year == 2023) %>%
  group_by(institute_district,typeof_institute,reported_institute) %>%
  summarise(student_count = n(), .groups = "drop") %>%
  select(reported_institute, student_count, typeof_institute, institute_district) %>%
    arrange(desc(student_count)) %>%
    slice_head(n = 10)

# Polytechnics
poly_level_student_count = student_dip_admis %>%
  filter(year == 2023) %>%
  group_by(institute_district,typeof_institute,reported_institute) %>%
  summarise(student_count = n(), .groups = "drop") %>%
  select(reported_institute, student_count, typeof_institute, institute_district) %>%
  arrange(desc(student_count)) %>%
  slice_head(n = 10)

# Institutes with highest female enrollment 2023
# ITI
iti_level_fem_student_count = student_iti_admis %>%
  filter(year == 2023) %>%
  group_by(institute_district,typeof_institute,reported_institute) %>%
  summarise(female_students = sum(gender == "Female"), .groups = "drop") %>%
  select(reported_institute, female_students, typeof_institute, institute_district) %>%
    arrange(desc(female_students)) %>%
    slice_head(n = 10)

# Polytechnics
poly_level_fem_student_count = student_dip_admis %>%
  filter(year == 2023) %>%
  group_by(institute_district,typeof_institute,reported_institute) %>%
  summarise(female_students = sum(gender=="Female"), .groups = "drop") %>%
  select(reported_institute, female_students, typeof_institute, institute_district) %>%
  arrange(desc(female_students)) %>%
  slice_head(n = 10)


# count of available trades in ITIs 2023
iti_trade_count = student_iti_admis %>%
  filter(year == 2023) %>%
  group_by(institute_district, reported_institute, typeof_institute) %>%
  summarise(trade_count = n_distinct(reported_branch_or_trade), .groups = "drop") %>%
  arrange(desc(trade_count)) %>% 
  select(reported_institute, trade_count, typeof_institute,institute_district) %>%
  slice_head(n = 10)

# count of available trades in ITIs 2023
poly_trade_count = student_dip_admis %>%
  filter(year == 2023) %>%
  group_by(institute_district, reported_institute, typeof_institute) %>%
  summarise(branch_count = n_distinct(reported_branch_or_trade), .groups = "drop") %>%
  arrange(desc(branch_count)) %>% 
  select(reported_institute, branch_count, typeof_institute,institute_district) %>%
  slice_head(n = 10)



```


```{r tables, echo=FALSE, results='asis'}
iti_student_count_summary %>%
  knitr::kable(caption = "Table _: Count of ITI Students", digits = 1) %>%
  kableExtra::kable_styling(bootstrap_options = "striped",full_width = FALSE)

dip_student_count_summary %>%
  knitr::kable(caption = "Table _: Count of Polytechnic Students", digits = 1) %>%
  kableExtra::kable_styling(bootstrap_options = "striped",full_width = FALSE)

iti_institutes_count_pivoted_summary %>%
  knitr::kable(caption = "Table _: Count of ITIs", digits = 1) %>%
  kableExtra::kable_styling(bootstrap_options = "striped",full_width = FALSE)

poly_institutes_count_pivoted_summary  %>%
  knitr::kable(caption = "Table _: Count of Polytechnics", digits = 1) %>%
  kableExtra::kable_styling(bootstrap_options = "striped",full_width = FALSE)

iti_level_student_count  %>%
  knitr::kable(caption = "Table _: Top 10 ITIs with Highest Student Enrollment", digits = 1) %>%
  kableExtra::kable_styling(bootstrap_options = "striped",full_width = FALSE)

poly_level_student_count  %>%
  knitr::kable(caption = "Table _: Top 10 ITIs with Highest Female Student Enrollment", digits = 1) %>%
  kableExtra::kable_styling(bootstrap_options = "striped",full_width = FALSE)

iti_level_fem_student_count  %>%
  knitr::kable(caption = "Table _: Top 10 Polytechnics with Highest Student Enrollment", digits = 1) %>%
  kableExtra::kable_styling(bootstrap_options = "striped",full_width = FALSE)

poly_level_fem_student_count  %>%
  knitr::kable(caption = "Table _: Top 10 Polytechnics with Highest Female Student Enrollment", digits = 1) %>%
  kableExtra::kable_styling(bootstrap_options = "striped",full_width = FALSE)

iti_trade_count  %>%
  knitr::kable(caption = "Table _: Top 10 ITIs with Highest Number of Trades", digits = 1) %>%
  kableExtra::kable_styling(bootstrap_options = "striped",full_width = FALSE)

poly_trade_count  %>%
  knitr::kable(caption = "Table _: Top 10 Polytechnics with Highest Number of Branches", digits = 1) %>%
  kableExtra::kable_styling(bootstrap_options = "striped",full_width = FALSE)

```



## Trade/Branch


